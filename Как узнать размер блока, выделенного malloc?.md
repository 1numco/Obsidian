Маллок в современном С++ не играет такую важную роль в разработке, как это есть и было в разработке на чистом С. Однако мы до сих пор встречаемся с легаси кодом(и вряд ли когда-нибудь перестанем это делать) и поэтому нам нужно знать некоторые тонкости и особенности языка С.

Маллок и еще несколько функций всегда используются в паре с free() как комбинация выделения и освобождения памяти. Но задумывались ли вы, почему в маллок мы передает размер массива, а во free - нет? Что делать, если я забыл, сколько я памяти выделил и мне нужно это узнать?

Дело в том, что это знание естественно хранится, просто ответственность за хранение не перекладывается на пользователя. Стандартный аллокатор выделяет на самом деле немного больше памяти, чем просите вы. Дополнительная память выделятся под **внутренние структуры аллокатора** и, ожидаемо, размер выделенной памяти. Напоминаю, что *это все очень сильно привязано к реальной реализации стандартной библиотеки С*, поэтому сказать нечто большее без привязки к реальной системе и коду нельзя.

Поэтому, зная указатель на выделенный блок, аллокатор сам знает, как ему найти реальное начало выделенного блока и реальное количество выделенных байт. Значит для освобождения памяти пользователю не нужно знать размер блока.

Что насчет того, может ли пользователь узнать размер выделенной памяти. И да, и нет. Скорее нет, чем да. Библиотека Linux систем предоставляет такую функцию, как malloc_usable_size, которая возвращает длину **реально выделенного блока памяти**. Это значит, что вы не получите то количество байт, которое вы запросили. Вам вернется несколько большее число. И это число определяется только имплементацией. Никто заранее в точности вам не скажет верное число.

Вряд ли вы когда-нибудь забывали размер выделенного блока, поэтому тоже вряд ли, что в продакшен коде вы будете это использовать(учитывая, что решение неточное и непереносимое). Но, надеюсь, вы немного больше узнали о стандартном аллокаторе.

Stay aware. Stay cool.

[![Hack the Virtual Memory: malloc, the heap & the program break - Blog  Holberton School](https://s3-us-west-1.amazonaws.com/holbertonschool/medias/0x10-malloc.png)![Hack the Virtual Memory: malloc, the heap & the program break - Blog  Holberton School](https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRW_OCJ4e7SVFscNyoFe9SWj5b--s-T_nVpmA&usqp=CAU)](https://www.google.com/url?sa=i&url=https%3A%2F%2Fblog.holbertonschool.com%2Fhack-the-virtual-memory-malloc-the-heap-the-program-break%2F&psig=AOvVaw1wWvdNOCFD3MdrDecuQLwx&ust=1699850809422000&source=images&cd=vfe&opi=89978449&ved=0CBEQjRxqFwoTCJDUhe_TvYIDFQAAAAAdAAAAABA_)





